<head>

<script>

/*
var periode; 
var fn1; 
var fn2; 

function boucle(iPeriode,fnCbTraitement,fnCbContinuer) {
	// Objectif : déclencher un appel à la fonction fnCbTraitement
	// toutes les iPeriode secondes, 
	// tant que fnCbContinuer renvoie vrai
	// TODO : supprimer les var. globales 
	// EN + : rendre le 3ème argument optionnel 
	
	if (iPeriode != undefined) {
		periode = iPeriode; 
		fn1 = fnCbTraitement; 
		fn2 = fnCbContinuer; 
	}
	
	if (fn2()) {
		fn1();
		window.setTimeout(boucle, periode*1000); 
	}

	// Utiliser obligatoirement window.setTimeout
	// setTimeout(functionRef, delay)
	// Interdiction d'utiliser les arguments optionnels de window.setTimeout

	// fnCbTraitement est une fonction de rappel ("CALLBACK")
	// elle sera appelée plus tard
	// pour l'appeler, il suffit d'ajouter les parenthèses !

	// rendre le 3ème argument optionnel

}
*/

function boucle(iPeriode,fnCbTraitement,fnCbContinuer) {
	// supprimer les var. globales 
	// rendre le 3ème argument optionnel 
	// TODO : rendre TOUS les arguments optionnels !! 
	// => on passe un objet de configuration en paramètre
	// {periode:, traiter:, poursuivre:}
	// {}
	// {traiter:}
	// {poursuivre:, periode:}
	
	var foo = function() {
		// permet d'enfermer dans son scope les variables locales de boucle
		// Elle a accès aux paramètres formels de boucle !
		
		if (
					(fnCbContinuer == undefined) 
				|| fnCbContinuer()
			) {
			fnCbTraitement();
			window.setTimeout(foo, iPeriode*1000); 
		}
	}; 
	
	foo();
}


var oDefault = {
	periode: 5, 
	traiter: function(){console.log("traitement");},
	poursuivre: function(){return true;}
}; 

function oBoucle(oConfig) {
	// TODO : rendre TOUS les arguments optionnels !! 
	// => on passe un objet de configuration en paramètre
	
	var oParams = oDefault; // ceci n'est pas une copie !! 
	// c'est une prise de référence !! 
	// => les comportements sont sauvegardés dans une unique variable oDefault

	
	if (oConfig.periode != undefined) oParams.periode = oConfig.periode;
	if (oConfig.traiter != undefined) oParams.traiter = oConfig.traiter;
	if (oConfig.poursuivre != undefined) oParams.poursuivre = oConfig.poursuivre;
	
	var foo = function() {
		// permet d'enfermer dans son scope les variables locales de oBoucle
		if (oParams.poursuivre()){
			oParams.traiter();
			window.setTimeout(foo, oParams.periode*1000); 
		}
	}; 
	
	foo();
}


var compteur2=0; 
function traiter2() {
	console.log("compteur2:" + compteur2++); 
}
var compteur=0; 
function traiter() {
	console.log("compteur:" + compteur++); 
}
function continuer() {
	if (compteur <5) return true; 
	else return false; 
}
/*
boucle(5,traiter,continuer); 
boucle(2,traiter2); 
*/

oBoucle({"periode":2, "traiter":traiter, "poursuivre":continuer});
oBoucle({});
oBoucle({"traiter":traiter});
	// {poursuivre:, periode:}
	
	
</script>
</head>
<body>


</body>










