<head>

<script>

/*
var periode; 
var fn1; 
var fn2; 

function boucle(iPeriode,fnCbTraitement,fnCbContinuer) {
	// Objectif : déclencher un appel à la fonction fnCbTraitement
	// toutes les iPeriode secondes, 
	// tant que fnCbContinuer renvoie vrai
	// TODO : supprimer les var. globales 
	// EN + : rendre le 3ème argument optionnel 
	
	if (iPeriode != undefined) {
		periode = iPeriode; 
		fn1 = fnCbTraitement; 
		fn2 = fnCbContinuer; 
	}
	
	if (fn2()) {
		fn1();
		window.setTimeout(boucle, periode*1000); 
	}

	// Utiliser obligatoirement window.setTimeout
	// setTimeout(functionRef, delay)
	// Interdiction d'utiliser les arguments optionnels de window.setTimeout

	// fnCbTraitement est une fonction de rappel ("CALLBACK")
	// elle sera appelée plus tard
	// pour l'appeler, il suffit d'ajouter les parenthèses !

	// rendre le 3ème argument optionnel

}
*/

function boucle(iPeriode,fnCbTraitement,fnCbContinuer) {
	// supprimer les var. globales 
	// rendre le 3ème argument optionnel 
	// TODO : rendre TOUS les arguments optionnels !! 
	// => on passe un objet de configuration en paramètre
	// {periode:, traiter:, poursuivre:}
	// {}
	// {traiter:}
	// {poursuivre:, periode:}
	
	var foo = function() {
		// permet d'enfermer dans son scope les variables locales de boucle
		// Elle a accès aux paramètres formels de boucle !
		
		if (
					(fnCbContinuer == undefined) 
				|| fnCbContinuer()
			) {
			fnCbTraitement();
			window.setTimeout(foo, iPeriode*1000); 
		}
	}; 
	
	foo();
}


var oDefault = {
	periode: 5, 
	traiter: function(){console.log("traitement");},
	poursuivre: function(){return true;}
}; 

function enrichir(oDef,oModif) {
	// produit un nouvel objet différent de oDef et oModif
	// ayant la même structure que oDef 
	// avec des valeurs de oModif 
	// (et celles de oDef quand oModif ne les précise pas)
	
	var oRes = {}; 
	for (prop in oDef) {
		if ((oModif != undefined) && (oModif[prop] != undefined))
			oRes[prop] = oModif[prop]; 
		else 
			oRes[prop] = oDef[prop]; 
	}
	
	return oRes; 
}

function oBoucle(oConfig) {
	// TODO : rendre TOUS les arguments optionnels !! 
	// => on passe un objet de configuration en paramètre
	
	// var oParams = oDefault; // ceci n'est pas une copie !! 
	// c'est une prise de référence !! 
	// => les comportements sont sauvegardés dans une unique variable oDefault
	
	// SOLUTION : cloner 
	// https://fdu-blog.medium.com/js-cloner-un-objet-612bcc444fd6 
	// Object.assign()
	// La méthode Object.assign() est utilisée afin de copier les valeurs de toutes les propriétés directes (non héritées) d’un objet qui sont énumérables sur un autre objet cible. Cette méthode renvoie l’objet cible. — Developer Mozilla
	// clonage superficiel : fabrique un nouvel ayant les mêmes propriétés qu'un autre mais qui n'est pas une référence vers cet autre
	// PB : si parmi les valeurs, il y a des références, on copie les références !
	 
	// clonage profond : 
	
	// JSON.parse(JSON.stringify(obj))
	// seulement pour des objets ne comportant pas de fonctions
	
	// jquery .clone 
	
	// TODO : enrichir(oDef,oModif)
	// effectue un clonage superficiel de oDef 
	// ET un enrichissement en exploitant les données de oModif  
	// => Faire une fonction générique à l'aide de la structure for ( in ) 

	/*
	if (oConfig.periode != undefined) oParams.periode = oConfig.periode;
	if (oConfig.traiter != undefined) oParams.traiter = oConfig.traiter;
	if (oConfig.poursuivre != undefined) oParams.poursuivre = oConfig.poursuivre;
	*/
	
	var oParams = enrichir(oDefault,oConfig);
	
	var foo = function() {
		// permet d'enfermer dans son scope les variables locales de oBoucle
		if (oParams.poursuivre()){
			oParams.traiter();
			window.setTimeout(foo, oParams.periode*1000); 
		}
	}; 
	
	foo();
}


var compteur2=0; 
function traiter2() {
	console.log("compteur2:" + compteur2++); 
}
var compteur=0; 
function traiter() {
	console.log("compteur:" + compteur++); 
}
function continuer() {
	if (compteur <5) return true; 
	else return false; 
}
/*
boucle(5,traiter,continuer); 
boucle(2,traiter2); 
*/

oBoucle({"periode":2, "traiter":traiter, "poursuivre":continuer});
oBoucle({});
oBoucle({"traiter":traiter});
oBoucle();
	// {poursuivre:, periode:}
	
	
</script>
</head>
<body>


</body>










